
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml">
   
   	
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
      <link rel="stylesheet" type="text/css" href="explain.css" />
      <title>JavaScript Exercise 3 (CDV)</title>
   </head>
   
   
   
   <body>
      <!--#include virtual="top.html" -->
      	
      			
      				
      <h1><span class="banner">JavaScript Exercise 3</span></h1>
      <p>In this exercise, we will enhance our output from <a href="SVGExercise2_CDV.html">SVG Exercises 2</a> and <a href="SVGExercise3_CDV.html">3</a>, that is, the timeline we output in SVG from XQuery on the Digital Mitford letters collection stored in our eXist database. At that stage, we output a vertical timeline that ran down the screen and required scrolling, and we plotted a parallel line showing how just one correspondent, Benjamin Robert Haydon, aligned with the total collection timeline. The parallel line marked the earliest and latest letters addressed to him and indicated the stretch of time represented by his letters.</p>
      <h2>Our goals</h2>
      <p>We will prepare our timeline to sit on a project webpage as a clickable infographic that helps us to survey the contents of our collection of files. This involves some alterations to the original XQuery we wrote, prior to drafting JavaScript. Our new code will do the following:</p>
      <ul>
         <li>Output an SVG line <em>for each</em> of the correspondents in the collection (not just for Benjamin Robert Haydon). 
         <ul>
            <li>Plot the timelines horizontally this time, so the earliest dates are on the left of the screen and the latest on the right.</li>
            <li>Prepare the SVG viewport so the lines do not require scrolling to be viewed.</li> 
         </ul>
         </li>
         <li>Output a clickable web form in HTML listing each correspondent, and assemble a document that successfully integrates HTML with SVG.</li>
         <li>Write JavaScript so that the SVG timelines for each of Mitford's correspondents can be toggled from the HTML portion of the page. Our visitors should be able to show and hide particular lines so they can compare the time spans associated with particular correspondents on the list. On click of one or more names, we should be able to reveal the lines we are interested in seeing.</li>
      </ul>
   
<h2>Help with details</h2>
      <h3>XQuery to output HTML with SVG</h3>
      <p>Optimally, we want to generate our HTML page with SVG set within it, so that the same XQuery functions generate the entire page. This is a bit of a challenge for outputting code in multiple namespaces. Here is how we did it:</p>
      
      <!--Notes:
      Output namespaces in eXide. We prefixed htm for EVERY html element, and we used the prefix tei when reading from our TEI files. We made SVG the default namespace. You might try this differently: make HTML the default namespace (no prefix required), and prefix the svg elements. SHOW CODE BLOCK FOR THIS.
      
      You can add the script element signalling your JavaScript file in your XQuery script, or after the step below, when you open and spot-repair the file in  &lt;oXygen/&gt;.
      -->    
      <p>Your output HTML and SVG will be missing the proper DOCTYPE declaration and the HTML root element will be missing its namespace attribute. Download the file from eXide, save it elsewhere to be mounted on your webspace at the PSC, and open it in &lt;oXygen/&gt;. You can add what you need by opening a new HTML 5 document in &lt;oXygen/&gt; and adding those features. &lt;oXygen/&gt; should give you a green light if all is well.</p>
      <h3>JavaScript</h3>
         <ul><li>In your JavaScript you will likely be doing some familiar things you have already tried, but you will face new challenges, too. Think about what needs to happen in sequence:
         <ul>
            <li>On load of the window, you will want to fire a function, the one we typically call <code>init()</code>. That init() (or initial()) function should add event listeners on the elements you expect your site visitors to interact with. This is familiar territory, but we found ourselves writing the element selection a little differently than we have done in the past: In our SVG, we set <code>@id</code> attributes on each <code>&lt;g&gt;</code> element, and there was at least one outer <code>&lt;g&gt;</code> containing an entire graph. We only wanted something to happen on click of each stacked bar, so we wanted the inner <code>&lt;g&gt;</code>  elements to be made <q>clickable</q>. To do that we used a handy selector in JavaScript that uses CSS syntax to identify <em>elements that hold a specific attribute</em> called <code>querySelectorAll()</code>: We wrote it like this to define an array of elements:
            <pre>
                var svgSelect = document.querySelectorAll('g[id]');
               
            </pre>
               That code creates an array of all the <code>&lt;g&gt;</code> elements that hold an @id attribute. After this we set up a for-loop with the range variable <code>i</code> to step through each member of the array of <code>svgSelect.length</code>, and then we set up our <code>addEventListener()</code> to run on the <code> svgSelect[i]</code> (or the svgSelect variable at position i), and to fire the next function() in sequence in the event of <code>'click'</code>, just as you have already done on previous assignments. <strong>Note:</strong> If you use the @id in other ways on your outer wrapper <code>&lt;g&gt;</code> elements, you will need to do something more, perhaps to set a <code>@class</code> attribute on just the <code>&lt;g&gt;</code> elements you want to grab here. (Modifying your code to suit your specific plan is part of this assignment!)</li>
            <li>Our JavaScript defines two more functions after <code>function init()</code>, and remember that each function needs to call the others in turn for your JavaScript to work. . . </li></ul></li></ul>
   </body>
   
   
   
   
</html>